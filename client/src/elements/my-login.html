<link rel="import" href="../../bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">


<dom-module id="my-login">
	<template>
		<firebase-auth id="auth" 
					   user="{{user}}" 
					   provider="google" 
					   on-error="handleError"
					   on-signed-in-changed ="handlesignon">
		</firebase-auth>

		<div>
			

		<paper-button raised on-tap="login" hidden$="[[user]]" style="background-color: #4caf50;;color: white;text-transform: none;">Sign In</paper-button>
		<p><h4 style="background-color: #4caf50;;color: white;">[[user.displayName]]</h4><paper-button raised on-tap="logout" hidden$="[[!user]]" style="background-color: #4caf50;;color: white;text-transform: none;float: right;">Sign Out</paper-button></p>
		</div>
	</template>
	<script type="text/javascript">
		Polymer({
			is: "my-login",
			properties: {
				user: Object
			},
			login: function() {
				if(this.$.auth.signedIn === true){
					// var x = event.currentTarget;
					this.$.auth.signOut().then( 
						function() { document.querySelector('#hpcc-info-app').querySelector('#signinout').textContent = 'Sign-In';
						}).then( function() {
						});
				
				}else{
					return this.$.auth.signInWithPopup()
						.then(function(response) {
							document.querySelector('#hpcc-info-app').querySelector('#signinout').textContent = 'Sign-Out';
							var infoBox = document.querySelector('#infobox');
							infoBox.properties.updatedby = response.user.email;

						})// optionally handle a successful login
						.catch(function(error) {// unsuccessful authentication response here
							console.log(error);
						});
				}
			},

			logout: function() {
				return this.$.auth.signOut();
			},

			handleError: function(e) {
				console.log(e);
			},
            handlesignon : function(e){
		       var infoBox = document.querySelector('#infobox');
			   if(this.$.auth.signedIn === true){
			   infoBox.properties.updatedby = this.$.auth.user.email;
			}
			}
		});
	</script>
</dom-module>